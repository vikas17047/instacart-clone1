<script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js";
    import { getFirestore, collection, getDocs } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js";

    const firebaseConfig = {
      apiKey: "AIzaSyCqh5b-p5dsiU6AtkWRbyD0rSUD62Izqeg",
      authDomain: "instacart-clone-91062.firebaseapp.com",
      projectId: "instacart-clone-91062",
      storageBucket: "instacart-clone-91062.firebasestorage.app",
      messagingSenderId: "232217818928",
      appId: "1:232217818928:web:e05efedfda36263f6cfaf5"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    // Page Load Hote hi Products layega
    window.onload = async function() {
        loadDesign(); // Design Load karega
        
        const gridContainer = document.getElementById('productContainer');
        gridContainer.innerHTML = '<p style="text-align:center; width:200%;">Loading products...</p>';

        try {
            // Firebase se data mangwana
            const querySnapshot = await getDocs(collection(db, "products"));
            
            gridContainer.innerHTML = ""; 
            
            if(querySnapshot.empty) {
                gridContainer.innerHTML = '<p>No products found. Seller dashboard se add karein.</p>';
            }

            querySnapshot.forEach((doc) => {
                let data = doc.data();
                // Card Banana
                let card = `
                    <div class="card">
                        <img src="${data.image}" class="c-img">
                        <div class="c-info">
                            <div class="c-title">${data.name}</div>
                            <div class="c-price">â‚¹${data.price}</div>
                            <button class="add-btn" onclick="addToCart('${data.name}', '${data.price}', '${data.image}')">Add to Bag</button>
                        </div>
                    </div>
                `;
                gridContainer.innerHTML += card;
            });

        } catch (error) {
            console.error("Error:", error);
            gridContainer.innerHTML = '<p>Error loading products.</p>';
        }
        updateCartCount();
    }

    // Baaki Functions (Design, Cart) - Same as before
    function loadDesign() {
        const name = localStorage.getItem('store_name') || "My Store";
        const desc = localStorage.getItem('store_desc') || "Welcome";
        const color = localStorage.getItem('store_color') || "#000000";
        const banner = localStorage.getItem('store_banner') || "https://images.unsplash.com/photo-1441986300917-64674bd600d8?w=800";
        const layout = localStorage.getItem('store_layout') || "grid";
        const font = localStorage.getItem('store_font') || "Inter";

        document.getElementById('storeName').innerText = name;
        document.getElementById('storeDesc').innerText = desc;
        document.getElementById('headerBg').style.backgroundImage = `url('${banner}')`;
        document.documentElement.style.setProperty('--theme-color', color);
        document.body.style.fontFamily = `'${font}', sans-serif`;

        const gridContainer = document.getElementById('productContainer');
        if(gridContainer) gridContainer.classList.add(layout + '-view');
    }

    window.addToCart = function(name, price, img) {
        let cart = JSON.parse(localStorage.getItem('myCart')) || [];
        cart.push({ name, price, img, qty: 1 });
        localStorage.setItem('myCart', JSON.stringify(cart));
        updateCartCount();
        document.getElementById('cartPopup').style.display = 'flex';
    }

    window.closePopup = function() { document.getElementById('cartPopup').style.display = 'none'; }

    window.updateCartCount = function() {
        let cart = JSON.parse(localStorage.getItem('myCart')) || [];
        let badge = document.getElementById('cartCount');
        if(cart && badge) {
            if(cart.length > 0) {
                badge.innerText = cart.length;
                badge.style.display = 'flex';
            } else {
                badge.style.display = 'none';
            }
        }
    }
</script>
