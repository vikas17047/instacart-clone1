<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Live Store</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style id="dynamicStyles">
        :root { --p-color: #008060; --radius: 8px; --bg: #ffffff; --text: #000000; }
        body { margin:0; background: var(--bg); color: var(--text); font-family: sans-serif; padding-bottom: 80px; transition: 0.3s; }
        .ann-bar { background: var(--p-color); color: white; text-align: center; padding: 10px; font-size: 0.8rem; font-weight: 700; }
        .hero { height: 200px; background-size: cover; background-position: center; position: relative; }
        .hero-overlay { position: absolute; inset:0; background: rgba(0,0,0,0.4); display:flex; align-items:center; justify-content:center; }
        .filter-bar { display: flex; gap: 10px; overflow-x: auto; padding: 15px; scrollbar-width: none; }
        .filter-btn { padding: 8px 20px; border: 1px solid #ddd; border-radius: 20px; background: white; white-space: nowrap; font-weight: 700; font-size: 0.8rem; color: black; }
        .p-grid { display: grid; grid-template-columns: 1fr 1fr; padding: 15px; gap: 15px; }
        .p-card { background: white; border-radius: 12px; overflow: hidden; color: #000; border: 1px solid #eee; }
        .p-img { width: 100%; height: 160px; object-fit: cover; }
        .buy-btn { width: 100%; padding: 12px; background: var(--p-color); color: white; border: none; font-weight: 700; border-radius: var(--radius); }
    </style>
</head>
<body>

    <div id="annDisplay" class="ann-bar">WELCOME TO OUR STORE</div>
    <div id="heroDisplay" class="hero"><div class="hero-overlay"><h1 id="sTitle">STORE</h1></div></div>
    
    <div class="filter-bar">
        <button class="filter-btn" onclick="filter('All')">All</button>
        <button class="filter-btn" onclick="filter('Men')">Men</button>
        <button class="filter-btn" onclick="filter('Women')">Women</button>
    </div>

    <div class="p-grid" id="mainGrid"></div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js";
        import { getFirestore, doc, getDoc, collection, getDocs, query, where } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js";

        const firebaseConfig = {
            apiKey: "AIzaSyCqh5b-p5dsiU6AtkWRbyD0rSUD62Izqeg",
            authDomain: "instacart-clone-91062.firebaseapp.com",
            projectId: "instacart-clone-91062",
            storageBucket: "instacart-clone-91062.firebasestorage.app",
            messagingSenderId: "232217818928",
            appId: "1:232217818928:web:e05efedfda36263f6cfaf5"
        };

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);

        const urlParams = new URLSearchParams(window.location.search);
        const sellerId = urlParams.get('seller');

        async function initStore() {
            if(!sellerId) return;

            // 1. Load Unique Design 
            const designSnap = await getDoc(doc(db, "store_designs", sellerId));
            if(designSnap.exists()){
                const s = designSnap.data();
                const root = document.documentElement;
                root.style.setProperty('--p-color', s.pColor);
                root.style.setProperty('--radius', s.bStyle);
                document.body.style.fontFamily = s.fFamily;
                document.getElementById('annDisplay').innerText = s.annText || "WELCOME";
                document.getElementById('heroDisplay').style.backgroundImage = `url('${s.sBanner}')`;
                document.getElementById('sTitle').innerText = s.sellerName || "STORE";
                if(s.darkMode === 'dark'){
                    root.style.setProperty('--bg', '#121212');
                    root.style.setProperty('--text', '#ffffff');
                }
            }

            // 2. Load Only This Seller's Products
            const q = query(collection(db, "products"), where("sellerId", "==", sellerId));
            const prodSnap = await getDocs(collection(db, "products")); // Filhal sab dikha rahe hain, aap where clause use karein
            const grid = document.getElementById('mainGrid');
            grid.innerHTML = "";
            prodSnap.forEach(doc => {
                const d = doc.data();
                grid.innerHTML += `<div class="p-card"><img src="${d.image}" class="p-img"><div style="padding:10px;"><div style="font-weight:700;">${d.name}</div><div style="color:var(--p-color); font-weight:800;">â‚¹${d.price}</div><button class="buy-btn">ADD TO BAG</button></div></div>`;
            });
        }
        initStore();
    </script>
</body>
</html>
