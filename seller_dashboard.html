<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Seller Dashboard - Instacart</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;600;800&display=swap" rel="stylesheet">
    <style>
        body { background: #f6f6f7; font-family: 'Plus Jakarta Sans', sans-serif; margin: 0; padding-bottom: 80px; }
        .nav-header { background: #1a1c1d; color: white; padding: 15px 20px; display: flex; justify-content: space-between; }
        .card { background: white; margin: 15px; padding: 15px; border-radius: 12px; box-shadow: 0 2px 8px rgba(0,0,0,0.05); }
        .order-card { border-left: 5px solid #ffcc00; margin-bottom: 10px; }
        .status-badge { font-size: 0.7rem; padding: 4px 8px; border-radius: 20px; font-weight: 800; text-transform: uppercase; }
        .status-pending { background: #fff4e5; color: #b7791f; }
        .status-shipped { background: #e6fffa; color: #2c7a7b; border-left-color: #38b2ac !important; }
        .ship-btn { background: #008060; color: white; border: none; padding: 10px; border-radius: 6px; width: 100%; font-weight: 700; cursor: pointer; margin-top: 10px; }
        .ship-input { width: 100%; padding: 8px; margin-top: 5px; border: 1px solid #ddd; border-radius: 5px; box-sizing: border-box; }
    </style>
</head>
<body>

    <div class="nav-header">
        <b style="font-size: 1.2rem;">Seller Hub</b>
        <span id="storeDisplayName">Loading Store...</span>
    </div>

    <div style="padding: 15px;">
        <h3 style="margin-bottom: 10px;">New Orders & Shipping</h3>
        <div id="sellerOrdersList">Loading orders...</div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js";
        import { getFirestore, collection, query, where, getDocs, updateDoc, doc } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js";
        import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-auth.js";

        const firebaseConfig = {
            apiKey: "AIzaSyCqh5b-p5dsiU6AtkWRbyD0rSUD62Izqeg",
            authDomain: "instacart-clone-91062.firebaseapp.com",
            projectId: "instacart-clone-91062",
            storageBucket: "instacart-clone-91062.firebasestorage.app",
            messagingSenderId: "232217818928",
            appId: "1:232217818928:web:e05efedfda36263f6cfaf5"
        };

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);
        const auth = getAuth(app);

        onAuthStateChanged(auth, (user) => {
            if (user) {
                loadSellerOrders(user.uid);
            } else {
                window.location.href = 'login.html';
            }
        });

        async function loadSellerOrders(sellerId) {
            const list = document.getElementById('sellerOrdersList');
            const q = query(collection(db, "orders"), where("sellerId", "==", sellerId));
            const snap = await getDocs(q);
            
            list.innerHTML = "";
            if(snap.empty) { list.innerHTML = "No orders found."; return; }

            snap.forEach(orderDoc => {
                const d = orderDoc.data();
                const isShipped = d.status === "Shipped";
                
                list.innerHTML += `
                    <div class="card order-card" style="${isShipped ? 'border-left-color:#38b2ac' : ''}">
                        <div style="display:flex; justify-content:space-between;">
                            <span class="status-badge ${isShipped ? 'status-shipped' : 'status-pending'}">${d.status || 'Pending'}</span>
                            <small>${new Date(d.orderDate).toLocaleDateString()}</small>
                        </div>
                        <h4 style="margin:10px 0 5px;">${d.productName}</h4>
                        <p style="font-size:0.8rem; color:#666;">Customer: ${d.customerName}<br>Address: ${d.address}</p>
                        
                        ${!isShipped ? `
                            <div id="shipBox-${orderDoc.id}">
                                <input type="text" id="track-${orderDoc.id}" class="ship-input" placeholder="Courier Name & Tracking ID">
                                <button class="ship-btn" onclick="markAsShipped('${orderDoc.id}')">MARK AS SHIPPED</button>
                            </div>
                        ` : `<p style="font-size:0.75rem; color:#2c7a7b;"><b>Tracking:</b> ${d.trackingDetails}</p>`}
                    </div>`;
            });
        }

        window.markAsShipped = async (orderId) => {
            const tracking = document.getElementById(`track-${orderId}`).value;
            if(!tracking) { alert("Please enter tracking details!"); return; }

            try {
                await updateDoc(doc(db, "orders", orderId), {
                    status: "Shipped",
                    trackingDetails: tracking
                });
                alert("Order marked as Shipped! ðŸšš");
                location.reload();
            } catch (e) { alert(e.message); }
        }
    </script>
</body>
</html>
