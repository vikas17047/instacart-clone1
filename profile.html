<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>My Profile - Instacart</title>
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        body { background: #f1f3f6; font-family: 'Inter', sans-serif; padding-bottom: 80px; margin: 0; }
        .profile-card { background: white; padding: 25px; display: flex; align-items: center; gap: 15px; margin-bottom: 10px; }
        .user-img { width: 70px; height: 70px; border-radius: 50%; object-fit: cover; }
        
        .section-title { padding: 15px; font-weight: 700; font-size: 0.9rem; color: #555; }
        
        /* ORDER HISTORY STYLE */
        .history-card {
            background: white; margin: 0 10px 10px 10px; padding: 15px; border-radius: 10px;
            display: flex; gap: 12px; align-items: center; border: 1px solid #eee;
        }
        .order-img { width: 55px; height: 55px; border-radius: 8px; object-fit: cover; }
        .order-details { flex: 1; }
        .order-name { font-weight: 700; font-size: 0.9rem; }
        .order-status { color: #0c831f; font-size: 0.75rem; font-weight: 700; margin-top: 3px; }

        .btn-seller-dash {
            background: linear-gradient(90deg, #11998e, #38ef7d); color: white;
            padding: 15px; margin: 10px; border-radius: 10px; font-weight: 700;
            display: flex; justify-content: space-between; align-items: center; cursor: pointer;
        }
    </style>
</head>
<body>

    <div class="profile-card">
        <img src="https://images.unsplash.com/photo-1535713875002-d1d0cf377fde?w=200" class="user-img" id="userPhoto">
        <div>
            <h2 style="margin:0; font-size:1.2rem;" id="userName">Rahul Kumar</h2>
            <p style="color:#888; font-size:0.85rem;" id="userPhone">+91 98765 43210</p>
        </div>
    </div>

    <div class="btn-seller-dash" onclick="window.location.href='seller_dashboard.html'">
        <div>
            <div>Go to Seller Dashboard</div>
            <span style="font-size:0.7rem; opacity:0.9;">Manage your own products & orders</span>
        </div>
        <i class="fas fa-chevron-right"></i>
    </div>

    <div class="section-title">MY ORDERS</div>
    <div id="orderHistoryContainer">
        <p style="text-align:center; padding:30px; color:#999; font-size:0.8rem;">Loading your orders...</p>
    </div>

    <div class="bottom-nav">
        <div class="nav-item" onclick="window.location.href='index.html'"><i class="fas fa-home"></i> Home</div>
        <div class="nav-item active"><i class="fas fa-user"></i> Profile</div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js";
        import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-auth.js";
        import { getFirestore, collection, query, where, getDocs } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js";

        const firebaseConfig = {
            apiKey: "AIzaSyCqh5b-p5dsiU6AtkWRbyD0rSUD62Izqeg",
            authDomain: "instacart-clone-91062.firebaseapp.com",
            projectId: "instacart-clone-91062",
            storageBucket: "instacart-clone-91062.firebasestorage.app",
            messagingSenderId: "232217818928",
            appId: "1:232217818928:web:e05efedfda36263f6cfaf5"
        };

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);

        onAuthStateChanged(auth, (user) => {
            if (user) {
                // Update Profile Info
                document.getElementById('userName').innerText = user.displayName;
                document.getElementById('userPhoto').src = user.photoURL;
                document.getElementById('userPhone').innerText = user.email; // Email as fallback
                
                loadUserOrders(user.displayName);
            } else {
                window.location.href = 'index.html'; // Login ke liye wapas bhej dena
            }
        });

        async function loadUserOrders(name) {
            const container = document.getElementById('orderHistoryContainer');
            // Customer ke naam se orders filter karna
            const q = query(collection(db, "orders"), where("customerName", "==", name));
            const snap = await getDocs(q);
            
            container.innerHTML = "";
            if(snap.empty) {
                container.innerHTML = "<p style='text-align:center; padding:30px; color:#999;'>No orders yet. Start shopping!</p>";
                return;
            }

            snap.forEach(doc => {
                const d = doc.data();
                container.innerHTML += `
                    <div class="history-card">
                        <img src="${d.productImg}" class="order-img">
                        <div class="order-details">
                            <div class="order-name">${d.productName}</div>
                            <div style="font-size:0.8rem; color:#666;">Price: â‚¹${d.totalAmount}</div>
                            <div class="order-status"><i class="fas fa-truck"></i> Out for Delivery</div>
                        </div>
                    </div>`;
            });
        }
    </script>
</body>
</html>
