<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>My Orders - Instacart</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;700;800&display=swap" rel="stylesheet">
    <style>
        body { background: #f8f9fa; font-family: 'Plus Jakarta Sans', sans-serif; margin: 0; padding-bottom: 80px; }
        .header { background: #fff; padding: 20px; text-align: center; border-bottom: 1px solid #eee; position: sticky; top: 0; z-index: 100; }
        .container { padding: 15px; }
        
        /* Order Card */
        .order-card { background: white; border-radius: 15px; padding: 20px; margin-bottom: 20px; box-shadow: 0 4px 12px rgba(0,0,0,0.05); }
        .product-info { display: flex; gap: 15px; align-items: center; margin-bottom: 15px; }
        .product-img { width: 70px; height: 70px; border-radius: 10px; object-fit: cover; }
        .product-details b { font-size: 1rem; display: block; }
        .product-details span { color: #666; font-size: 0.85rem; }

        /* Tracking Timeline Design */
        .timeline { margin-top: 20px; padding-left: 20px; border-left: 2px solid #ddd; position: relative; }
        .step { position: relative; padding-bottom: 20px; padding-left: 20px; }
        .step::before { content: ''; position: absolute; left: -27px; top: 0; width: 12px; height: 12px; border-radius: 50%; background: #ddd; border: 3px solid #fff; }
        .step.active::before { background: #008060; box-shadow: 0 0 0 4px rgba(0,128,96,0.2); }
        .step.active { color: #008060; font-weight: 700; }
        .step-title { font-size: 0.85rem; }
        .step-desc { font-size: 0.7rem; color: #888; font-weight: 400; margin-top: 2px; }

        .tracking-id { background: #f0f5ff; color: #2c6ecb; padding: 10px; border-radius: 8px; font-size: 0.75rem; margin-top: 15px; display: flex; align-items: center; gap: 10px; }
        
        .bottom-nav { position: fixed; bottom: 0; width: 100%; background: #fff; display: flex; justify-content: space-around; padding: 15px 0; border-top: 1px solid #eee; }
        .nav-item { color: #888; text-decoration: none; font-size: 0.8rem; text-align: center; }
        .nav-item.active { color: #000; font-weight: 800; }
    </style>
</head>
<body>

    <div class="header">
        <b style="font-size: 1.2rem;">My Orders</b>
    </div>

    <div class="container" id="ordersList">
        <p style="text-align:center; color:#888;">Checking your orders...</p>
    </div>

    <div class="bottom-nav">
        <a href="index.html" class="nav-item"><i class="fas fa-home"></i><br>Home</a>
        <a href="profile.html" class="nav-item active"><i class="fas fa-user"></i><br>Profile</a>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js";
        import { getFirestore, collection, query, where, getDocs } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js";
        import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-auth.js";

        const firebaseConfig = {
            apiKey: "AIzaSyCqh5b-p5dsiU6AtkWRbyD0rSUD62Izqeg",
            authDomain: "instacart-clone-91062.firebaseapp.com",
            projectId: "instacart-clone-91062",
            storageBucket: "instacart-clone-91062.firebasestorage.app",
            messagingSenderId: "232217818928",
            appId: "1:232217818928:web:e05efedfda36263f6cfaf5"
        };

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);
        const auth = getAuth(app);

        onAuthStateChanged(auth, (user) => {
            if (user) {
                loadMyOrders(user.displayName); // Name se fetch kar rahe hain
            } else {
                window.location.href = "login.html";
            }
        });

        async function loadMyOrders(userName) {
            const list = document.getElementById('ordersList');
            // Customer ke naam se saare orders filter karein
            const q = query(collection(db, "orders"), where("customerName", "==", userName));
            const snap = await getDocs(q);
            
            list.innerHTML = "";
            if(snap.empty) {
                list.innerHTML = "<div style='text-align:center; margin-top:100px;'>Abhi tak koi order nahi kiya gaya hai.</div>";
                return;
            }

            snap.forEach(doc => {
                const d = doc.data();
                const isShipped = d.status === "Shipped";

                list.innerHTML += `
                    <div class="order-card">
                        <div class="product-info">
                            <img src="${d.productImg || 'https://via.placeholder.com/70'}" class="product-img">
                            <div class="product-details">
                                <b>${d.productName}</b>
                                <span>Amount: â‚¹${d.totalAmount}</span>
                            </div>
                        </div>

                        <div class="timeline">
                            <div class="step active">
                                <div class="step-title">Order Placed</div>
                                <div class="step-desc">Aapka order mil gaya hai.</div>
                            </div>
                            <div class="step ${isShipped ? 'active' : ''}">
                                <div class="step-title">${isShipped ? 'Shipped' : 'Processing'}</div>
                                <div class="step-desc">${isShipped ? 'Saaman dukan se nikal gaya hai.' : 'Seller packing kar raha hai.'}</div>
                            </div>
                            <div class="step">
                                <div class="step-title">Delivered</div>
                                <div class="step-desc">Jaldi hi aapke ghar pahuchega.</div>
                            </div>
                        </div>

                        ${isShipped ? `
                            <div class="tracking-id">
                                <i class="fas fa-truck-moving"></i>
                                <span><b>Tracking:</b> ${d.trackingDetails}</span>
                            </div>
                        ` : ''}
                    </div>`;
            });
        }
    </script>
</body>
</html>
