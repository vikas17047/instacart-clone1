<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Payment - Instacart</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;700&display=swap" rel="stylesheet">
    <style>
        body { background: #f5f5f5; font-family: 'Inter', sans-serif; margin:0; padding-bottom:100px; }
        .header { background: white; padding: 15px; border-bottom: 1px solid #eee; display: flex; align-items: center; gap: 15px; }
        .pay-option { background: white; padding: 15px; border-bottom: 1px solid #eee; display: flex; align-items: center; justify-content: space-between; cursor: pointer; }
        .pay-left { display: flex; align-items: center; gap: 15px; }
        .btn-place { position: fixed; bottom: 0; left: 0; width: 100%; background: #0c831f; color: white; padding: 18px; border: none; font-weight: 700; font-size: 1rem; text-transform: uppercase; cursor: pointer; }
        .success-overlay { position: fixed; inset: 0; background: white; z-index: 3000; display: none; flex-direction: column; align-items: center; justify-content: center; text-align: center; }
    </style>
</head>
<body>

    <div class="header">
        <i class="fas fa-arrow-left" onclick="window.history.back()"></i>
        <div style="font-weight:700;">PAYMENT</div>
    </div>

    <div style="background:white; padding:20px; text-align:center; margin-bottom:10px;">
        <div style="color:#666; font-size:0.9rem;">Amount to Pay</div>
        <div style="font-size:2rem; font-weight:800;" id="finalAmt">₹0</div>
    </div>

    <div style="padding:15px; font-weight:700; color:#555; font-size:0.8rem;">CHOOSE PAYMENT METHOD</div>
    
    <label class="pay-option">
        <div class="pay-left">
            <i class="fas fa-money-bill-wave" style="color:green; font-size:1.5rem;"></i>
            <div>
                <div style="font-weight:600;">Cash on Delivery</div>
                <div style="font-size:0.75rem; color:#666;">Pay when you receive</div>
            </div>
        </div>
        <input type="radio" name="pay" checked>
    </label>

    <button class="btn-place" id="placeOrderBtn">PLACE ORDER</button>

    <div id="successScreen" class="success-overlay">
        <div style="width:80px; height:80px; border-radius:50%; background:#4caf50; color:white; display:flex; align-items:center; justify-content:center; font-size:3rem; margin-bottom:20px;">
            <i class="fas fa-check"></i>
        </div>
        <h2>Order Confirmed!</h2>
        <p style="color:#666; margin-top:10px;">Your order has been sent to the seller.</p>
        <button onclick="window.location.href='index.html'" style="margin-top:30px; padding:12px 35px; background:black; color:white; border:none; border-radius:30px; font-weight:700;">DONE</button>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js";
        import { getFirestore, collection, addDoc } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js";

        const firebaseConfig = {
            apiKey: "AIzaSyCqh5b-p5dsiU6AtkWRbyD0rSUD62Izqeg",
            authDomain: "instacart-clone-91062.firebaseapp.com",
            projectId: "instacart-clone-91062",
            storageBucket: "instacart-clone-91062.firebasestorage.app",
            messagingSenderId: "232217818928",
            appId: "1:232217818928:web:e05efedfda36263f6cfaf5"
        };

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);

        window.onload = function() {
            let total = localStorage.getItem('cartTotal') || 0;
            document.getElementById('finalAmt').innerText = "₹" + total;
        }

        document.getElementById('placeOrderBtn').onclick = async function() {
            this.disabled = true;
            this.innerText = "Processing...";

            // LocalStorage se data uthayein
            const cart = JSON.parse(localStorage.getItem('myCart')) || [];
            const customerName = localStorage.getItem('user_name') || "Customer";
            const address = localStorage.getItem('user_address') || "No Address";
            const total = localStorage.getItem('cartTotal') || 0;

            // Har item ke liye alag order create karein (Seller dashboard ke liye asaan hoga)
            try {
                for (let item of cart) {
                    await addDoc(collection(db, "orders"), {
                        customerName: customerName,
                        address: address,
                        productName: item.name,
                        productImg: item.img,
                        totalAmount: item.price,
                        orderDate: new Date().toISOString()
                    });
                }

                // Success!
                localStorage.removeItem('myCart');
                document.getElementById('successScreen').style.display = 'flex';
            } catch (e) {
                alert("Error: " + e.message);
                this.disabled = false;
                this.innerText = "PLACE ORDER";
            }
        }
    </script>
</body>
</html>
