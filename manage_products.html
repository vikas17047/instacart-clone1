<script type="module">
    // 1. Firebase Imports (Internet se connection)
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js";
    import { getFirestore, collection, addDoc } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js";

    // 2. Aapki Keys (Jo aapne copy ki thi)
    const firebaseConfig = {
      apiKey: "AIzaSyCqh5b-p5dsiU6AtkWRbyD0rSUD62Izqeg",
      authDomain: "instacart-clone-91062.firebaseapp.com",
      projectId: "instacart-clone-91062",
      storageBucket: "instacart-clone-91062.firebasestorage.app",
      messagingSenderId: "232217818928",
      appId: "1:232217818928:web:e05efedfda36263f6cfaf5"
    };

    // 3. Start Firebase
    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    // 4. Modal Functions (Popup kholne/band karne ke liye)
    window.openModal = function() { document.getElementById('addModal').style.display = 'flex'; }
    window.closeModal = function() { document.getElementById('addModal').style.display = 'none'; }
    
    // File Name Dikhana
    window.updateFileLabel = function(inputId, labelId, limit) {
        const input = document.getElementById(inputId);
        const label = document.getElementById(labelId);
        if (input.files.length > 0) {
            label.innerText = `${input.files.length} file(s) selected`;
            label.style.color = "green";
        }
    }

    // 5. MAIN FUNCTION: Product Save Karna
    window.addProduct = async function() {
        const btn = document.querySelector('.save-btn');
        btn.innerText = "Saving..."; 
        btn.disabled = true;

        let title = document.getElementById('newTitle').value;
        let price = document.getElementById('newPrice').value;
        let desc = document.getElementById('newDesc').value;
        
        // Dummy Image (Kyunki real upload ke liye Storage setup karna padega)
        let imgUrl = "https://images.unsplash.com/photo-1523275335684-37898b6baf30?w=400"; 
        
        if(title === "" || price === "") {
            alert("Please enter Name and Price");
            btn.innerText = "SAVE PRODUCT";
            btn.disabled = false;
            return;
        }

        try {
            // Data Cloud par bhejna
            await addDoc(collection(db, "products"), {
                name: title,
                price: price,
                desc: desc,
                image: imgUrl,
                date: new Date()
            });
            
            alert("Product Live Ho Gaya!");
            closeModal();
            location.reload(); 
            
        } catch (e) {
            console.error("Error:", e);
            alert("Error: " + e.message);
        }
        
        btn.innerText = "SAVE PRODUCT";
        btn.disabled = false;
    }
</script>
